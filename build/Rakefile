require "fileutils"

task :default => [:clean, :pack]

desc "Export unitypackage"
task :pack do
	puts "*** Start packaging ***"

	puts "Copying files into Packager..."
	FileUtils.cp_r("../sample/Assets/readme.txt", "./Packager/Assets");
	FileUtils.cp_r("../sample/Assets/Plugins", "./Packager/Assets");
	FileUtils.cp_r("../sample/Assets/GCM-Sample", "./Packager/Assets");

	puts "Exporting unitypackage..."
	current = Dir::pwd
	system("/Applications/Unity/Unity.app/Contents/MacOS/Unity -quit -batchmode -projectPath #{current}/Packager -logFile log.txt -executeMethod Exporter.Export");
	puts "*** End packaging ***"
end

desc "Remove temporary files"
task :clean do
	if File.exists?("./Packager/Assets/readme.txt")
		FileUtils.rm_r("./Packager/Assets/readme.txt");
	end
	if File.exists?("./Packager/Assets/Plugins")
		FileUtils.rm_r("./Packager/Assets/Plugins");
	end
	if File.exists?("./Packager/Assets/GCM-Sample")
		FileUtils.rm_r("./Packager/Assets/GCM-Sample");
	end
	if File.exists?("./log.txt")
		FileUtils.rm_r("./log.txt");
	end
end

